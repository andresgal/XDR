// to filter by DeviceName add this line replacing line 5
// where DeviceName == 'client2' and ActionType startswith 'ExploitGuard'
// you can add on project ProcessCommandLine, InitiatingProcessVersionInfoCompanyName, InitiatingProcessVersionInfoFileDescription, InitiatingProcessVersionInfoOriginalFileName, InitiatingProcessVersionInfoInternalFileName, 
DeviceEvents 
| where ActionType startswith 'ExploitGuard'
| extend policy = case(
    ActionType has "ExploitGuardWin32SystemCallBlocked", "Win32k system calls",
    ActionType has "ExploitGuardAcgEnforced", "Arbitrary code guard (ACG)",
    ActionType has "ExploitGuardNonMicrosoftSignedBlocked", "Code integrity guard" , 
    ActionType has "ExploitGuardChildProcessAudited","Do not allow child processes <Audited>",
    ActionType has "ExploitGuardChildProcessBlocked","Do not allow child processes <Blocked>",
    ActionType has "ExploitGuardEafViolationBlocked","Export address filtering (EAF)",
    ActionType has "ExploitGuardRopExploitBlocked","Simulate execution (SimExec)",
    ActionType has "ExploitGuardNetworkProtectionBlocked","SmartScreen Protection","Unknown")
| project DeviceName, Timestamp, ActionType, policy, FileName, InitiatingProcessFileName, InitiatingProcessFolderPath, InitiatingProcessParentFileName
| order by Timestamp, DeviceName, ActionType desc 
