// to filter by DeviceName use this line
// where DeviceName == 'client2' and ActionType startswith 'ExploitGuard'
// you can add ProcessCommandLine, InitiatingProcessVersionInfoCompanyName, InitiatingProcessVersionInfoFileDescription, InitiatingProcessVersionInfoOriginalFileName, InitiatingProcessVersionInfoInternalFileName, InitiatingProcessVersionInfoProductName, InitiatingProcessVersionInfoProductVersion, RegistryValueName, RegistryKey, RegistryValueData to summarize line
let policytable = DeviceEvents 
| where ActionType startswith 'ExploitGuard'
| extend policy = iif((ActionType in ('ExploitGuardWin32SystemCallBlocked')), 'Win32k system calls', iif((ActionType in ('ExploitGuardAcgEnforced')), 'Arbitrary code guard (ACG)',iif((ActionType in ('ExploitGuardNonMicrosoftSignedBlocked')), 'Code integrity guard',iif((ActionType in ('ExploitGuardNonMicrosoftSignedBlocked')),'Code integrity guard','Unknown'))))
| project DeviceName, policy; 
DeviceEvents |
 where ActionType startswith 'ExploitGuard'
| summarize count() by DeviceName,ActionType, Timestamp, FileName, InitiatingProcessFileName,  InitiatingProcessFolderPath, InitiatingProcessParentFileName
| project DeviceName, count_, Timestamp, ActionType, FileName, InitiatingProcessFileName, InitiatingProcessFolderPath, InitiatingProcessParentFileName
|join policytable on DeviceName
|project-away DeviceName1
|  order by Timestamp,count_,DeviceName desc

